<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>AR Debug Modu</title>
    
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>

    <style>
        body { margin: 0; background: #000; overflow: hidden; }
        
        /* HATA EKRANI STİLİ */
        #debug-console {
            position: fixed; top: 0; left: 0; width: 100%; height: 50%;
            background: rgba(255, 0, 0, 0.2); /* Hafif kırmızı zemin */
            color: lime; /* Yeşil yazılar */
            font-family: monospace; font-size: 14px;
            padding: 10px; box-sizing: border-box;
            z-index: 999999; pointer-events: none;
            overflow-y: scroll;
            text-shadow: 1px 1px 1px black;
        }
        
        #start-btn {
            position: fixed; bottom: 50px; left: 50%; transform: translateX(-50%);
            z-index: 10000; padding: 20px 40px; font-size: 20px;
            background: white; color: black; border: none; font-weight: bold;
        }
    </style>
</head>
<body>

    <div id="debug-console">Sistem Başlatılıyor...<br></div>
    
    <button id="start-btn">KAMERAYI AÇ</button>

    <a-scene 
        mindar-image="imageTargetSrc: ./aley/targets.mind; autoStart: false; uiLoading: no; uiScanning: no;" 
        color-space="sRGB" 
        renderer="colorManagement: true, physicallyCorrectLights" 
        vr-mode-ui="enabled: false" 
        device-orientation-permission-ui="enabled: false">
      
        <a-assets>
            <video id="arVideo" 
                   src="./aley/video.mp4" 
                   preload="auto" loop="true" crossorigin="anonymous" playsinline webkit-playsinline>
            </video>
        </a-assets>

        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

        <a-entity id="target" mindar-image-target="targetIndex: 0">
            <a-video src="#arVideo" width="1" height="0.56" position="0 0 0"></a-video>
        </a-entity>
    </a-scene>

    <script>
        const debugBox = document.getElementById('debug-console');
        const startBtn = document.getElementById('start-btn');
        const scene = document.querySelector('a-scene');
        const video = document.getElementById('arVideo');

        // Ekrana yazı yazma fonksiyonu
        function log(msg) {
            debugBox.innerHTML += ">> " + msg + "<br>";
            console.log(msg);
        }

        // 1. Tarayıcı ve HTTPS Kontrolü
        window.onload = function() {
            log("Sayfa Yüklendi.");
            if (location.protocol !== 'https:') {
                log("HATA: Site HTTPS değil! Kamera açılmaz.");
            } else {
                log("HTTPS güvenli bağlantı: OK");
            }

            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                log("HATA: Tarayıcın kamerayı desteklemiyor veya izin yok.");
            } else {
                log("Kamera donanımı algılandı.");
            }
        };

        // 2. Butona basınca başlat
        startBtn.addEventListener('click', () => {
            log("Butona basıldı, video hazırlanıyor...");
            startBtn.style.display = 'none';

            // Videoyu tetikle
            video.muted = true;
            video.play().then(() => {
                video.pause();
                log("Video oynatma izni alındı.");
            }).catch(e => {
                log("UYARI: Video izni alınamadı: " + e.message);
            });

            // MindAR'ı başlat
            log("MindAR sistemi başlatılıyor...");
            if (scene.systems['mindar-image-system']) {
                scene.systems['mindar-image-system'].start();
            } else {
                log("HATA: MindAR sistemi bulunamadı!");
            }
        });

        // 3. MindAR Olayları
        scene.addEventListener("arReady", () => {
            log("BAŞARILI: Kamera açıldı ve AR hazır!");
            debugBox.style.background = "rgba(0, 255, 0, 0.2)"; // Başarılıysa yeşil zemin
        });

        scene.addEventListener("arError", (event) => {
            log("KRİTİK HATA: AR Sistemi çöktü!");
            log("Detay: " + JSON.stringify(event.detail));
            
            if (event.detail && event.detail.error === 'LOAD_IMAGE_TARGET_FAILED') {
                 log("SEBEP: targets.mind dosyası okunamadı veya bozuk!");
                 log("Yol kontrolü: ./aley/targets.mind");
            }
        });

        // Global hata yakalayıcı
        window.onerror = function(message, source, lineno, colno, error) {
            log("JavaScript Hatası: " + message);
        };
    </script>
</body>
</html>
